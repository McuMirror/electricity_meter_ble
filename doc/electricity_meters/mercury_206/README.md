# Однофазный многотарифный счетчик Меркурий-206

<img src="https://raw.githubusercontent.com/slacky1965/electricity_meter_ble/main/doc/electricity_meters/mercury_206/mercury-206.jpg" alt="Mercury-206">

## Описание особенностей работы с этим счетчиком

Счетчик общается по [протоколу](https://www.incotexcom.ru/files/em/docs/mercury-protocol-obmena-1.pdf). Производителем заявлено, что этот протокол используется также в таких счетчиках, как Меркурий 200, 201, 203 (кроме Меркурий 203.2TD)

В настоящий момент устройство может прочитать из счетчика:

> 1. 3 тарифа (в kWh)
> 2. силу тока (в A)
> 3. напряжение сети (в V)
> 4. мощность (в W)
> 5. оставшийся ресурс батарии прибора (косвенно вычисляется, команды такой нет, в %)
> 6. полный серийный номер прибора (например 35900555)
> 7. дату изготовления прибора (например 10.12.2018)

Для корректного соединения со счетчиком в [WEB-конфигураторе](https://slacky1965.github.io/ble_utils/ElectricityMeterConfig.html) нужно ввести серийный номера прибора. Например для счетчика, который изображен на фото, это 36896545.

У этого счетчика нет команды запроса ресурса батареи. Поэтому оставшийся ресурс вычисляется из других параметров. Будем считать, что ресурс батареи порядка 10 лет или 120 месяцев. Также есть команда наработки счетчика в часах, отдельно от сети (при наличие входного напряжения 220 вольт) и отдельно от батареи (при отсутствии входного напряжения). Следовательно, мы просто вычисляем оставшийся ресурс в месяцах между датой производства и 120-тью месяцами (т.е. 10-тью годами). Ну а из этого потом легко получить проценты.

В процессе написания кода для этого счетчика выяснилось, что на первую (любую) команду между опросами, счетчик или не отвечает, или присылает какой-то мусор. А вот на последующие команды отвечает нормально. Поэтому сперва кидаем ему любую команду, делаем небольшую паузу (например 500 мсек) и только потом начинаем опрашивать счетчик.